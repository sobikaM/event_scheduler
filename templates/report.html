{% extends "base.html" %}

{% block content %}
<h2>Resource Utilization Report</h2>

<form method="GET" action="{{ url_for('report') }}" class="row g-3 mb-4">
    <div class="col-md-4">
        <label class="form-label">Start Date</label>
        <input type="date" class="form-control" name="start_date" value="{{ start_date }}" required>
    </div>
    <div class="col-md-4">
        <label class="form-label">End Date</label>
        <input type="date" class="form-control" name="end_date" value="{{ end_date }}" required>
    </div>
    <div class="col-md-4">
        <label class="form-label">&nbsp;</label>
        <button type="submit" class="btn btn-primary d-block w-100">Generate Report</button>
    </div>
</form>

{% if resources_usage is not none %}
    {% if resources_usage %}
    <div class="alert alert-info">
        Showing report from <strong>{{ start_date }}</strong> to <strong>{{ end_date }}</strong>
    </div>
    
    <div class="table-responsive">
        <table class="table table-striped">
            <thead class="table-dark">
                <tr>
                    <th>Resource</th>
                    <th>Type</th>
                    <th>Total Hours Utilized</th>
                    <th>Upcoming Bookings</th>
                </tr>
            </thead>
            <tbody>
                {% for resource in resources_usage %}
                <tr>
                    <td>{{ resource.resource_name }}</td>
                    <td>
                        <span class="badge 
                            {% if resource.resource_type == 'room' %}bg-primary
                            {% elif resource.resource_type == 'instructor' %}bg-success
                            {% else %}bg-warning text-dark{% endif %}">
                            {{ resource.resource_type }}
                        </span>
                    </td>
                    <td>{{ "%.2f"|format(resource.total_hours or 0) }} hours</td>
                    <td>
                        {% if resource.upcoming_bookings %}
                            {{ resource.upcoming_bookings.replace('; ', '<br>')|safe }}
                        {% else %}
                            No bookings in this period
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-warning">
        <h5>No Data Found</h5>
        <p class="mb-0">No resource utilization data found for the selected date range ({{ start_date }} to {{ end_date }}).</p>
    </div>
    {% endif %}
{% else %}
<div class="alert alert-light text-center">
    <h5>Select Date Range</h5>
    <p class="mb-0">Please select a start date and end date above, then click "Generate Report" to view resource utilization.</p>
</div>
{% endif %}
{% endblock %}